//Hermite resize - fast image resize/resample using Hermite filter.
//Version: 2.2.1
//Author: ViliusL
//https://github.com/viliusle/Hermite-resize
//http://viliusle.github.io/miniPaint/
function Hermite_class(){var t,a,e=[];this.init=function(){t=navigator.hardwareConcurrency||4}(),this.getCores=function(){return t},this.resample_auto=function(t,a,e,r,i){var h=this.getCores();window.Worker&&h>1?this.resample(t,a,e,r,i):(this.resample_single(t,a,e,!0),void 0!=i&&i())},this.resize_image=function(t,a,e,r,i){var h=document.getElementById(t),o=document.createElement("canvas");o.width=h.width,o.height=h.height;var n=o.getContext("2d");if(n.drawImage(h,0,0),void 0==a&&void 0==e&&void 0!=r&&(a=h.width/100*r,e=h.height/100*r),void 0==e){var s=h.width/a;e=h.height/s}a=Math.round(a),e=Math.round(e);var c=function(){var t=o.toDataURL();h.width=a,h.height=e,h.src=t,t=null,o=null};void 0==i||1==i?this.resample(o,a,e,!0,c):(this.resample_single(o,a,e,!0),c())},this.resample=function(r,i,h,o,n){var s=r.width,c=r.height;i=Math.round(i),h=Math.round(h);var d=c/h;if(e.length>0)for(var g=0;t>g;g++)void 0!=e[g]&&(e[g].terminate(),delete e[g]);e=new Array(t);for(var v=r.getContext("2d"),l=[],f=2*Math.ceil(c/t/2),u=-1,g=0;t>g;g++){var M=u+1;if(!(M>c)){u=M+f-1,u=Math.min(u,c-1);var m=f;m=Math.min(f,c-M),l[g]={},l[g].source=v.getImageData(0,M,s,f),l[g].target=!0,l[g].start_y=Math.ceil(M/d),l[g].height=m}}o===!0?(r.width=i,r.height=h):v.clearRect(0,0,s,c);for(var w=0,g=0;t>g;g++)if(void 0!=l[g].target){w++;var p=new Worker(a);e[g]=p,p.onmessage=function(t){w--;var a=t.data.core;delete e[a];var r=Math.ceil(l[a].height/d);l[a].target=v.createImageData(i,r),l[a].target.data.set(t.data.target),v.putImageData(l[a].target,0,l[a].start_y),0>=w&&void 0!=n&&n()};var _={width_source:s,height_source:l[g].height,width:i,height:Math.ceil(l[g].height/d),core:g,source:l[g].source.data.buffer};p.postMessage(_,[_.source])}},a=window.URL.createObjectURL(new Blob(["(",function(){onmessage=function(t){for(var a=t.data.core,e=t.data.width_source,r=t.data.height_source,i=t.data.width,h=t.data.height,o=e/i,n=r/h,s=Math.ceil(o/2),c=Math.ceil(n/2),d=new Uint8ClampedArray(t.data.source),g=(d.length/e/4,i*h*4),v=new ArrayBuffer(g),l=new Uint8ClampedArray(v,0,g),f=0;h>f;f++)for(var u=0;i>u;u++){var M=4*(u+f*i),m=0,w=0,p=0,_=0,y=0,b=0,C=0,I=f*n,D=Math.floor(u*o),R=Math.ceil((u+1)*o),U=Math.floor(f*n),A=Math.ceil((f+1)*n);R=Math.min(R,e),A=Math.min(A,r);for(var x=U;A>x;x++)for(var B=Math.abs(I-x)/c,L=u*o,j=B*B,k=D;R>k;k++){var q=Math.abs(L-k)/s,E=Math.sqrt(j+q*q);if(!(E>=1)){m=2*E*E*E-3*E*E+1;var W=4*(k+x*e);C+=m*d[W+3],p+=m,d[W+3]<255&&(m=m*d[W+3]/250),_+=m*d[W],y+=m*d[W+1],b+=m*d[W+2],w+=m}}l[M]=_/w,l[M+1]=y/w,l[M+2]=b/w,l[M+3]=C/p}var z={core:a,target:l};postMessage(z,[l.buffer])}}.toString(),")()"],{type:"application/javascript"})),this.resample_single=function(t,a,e,r){var i=t.width,h=t.height;a=Math.round(a),e=Math.round(e);for(var o=i/a,n=h/e,s=Math.ceil(o/2),c=Math.ceil(n/2),d=t.getContext("2d"),g=d.getImageData(0,0,i,h),v=d.createImageData(a,e),l=g.data,f=v.data,u=0;e>u;u++)for(var M=0;a>M;M++){var m=4*(M+u*a),w=0,p=0,_=0,y=0,b=0,C=0,I=0,D=u*n,R=Math.floor(M*o),U=Math.ceil((M+1)*o),A=Math.floor(u*n),x=Math.ceil((u+1)*n);U=Math.min(U,i),x=Math.min(x,h);for(var B=A;x>B;B++)for(var L=Math.abs(D-B)/c,j=M*o,k=L*L,q=R;U>q;q++){var E=Math.abs(j-q)/s,W=Math.sqrt(k+E*E);if(!(W>=1)){w=2*W*W*W-3*W*W+1;var z=4*(q+B*i);I+=w*l[z+3],_+=w,l[z+3]<255&&(w=w*l[z+3]/250),y+=w*l[z],b+=w*l[z+1],C+=w*l[z+2],p+=w}}f[m]=y/p,f[m+1]=b/p,f[m+2]=C/p,f[m+3]=I/_}r===!0?(t.width=a,t.height=e):d.clearRect(0,0,i,h),d.putImageData(v,0,0)}}
export default Hermite_class;
